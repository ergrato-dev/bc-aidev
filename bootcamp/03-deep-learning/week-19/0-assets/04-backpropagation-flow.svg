<svg viewBox="0 0 900 550" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4FC3F7"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#FF5252"/>
    </marker>
  </defs>
  
  <rect width="900" height="550" fill="#1a1a2e"/>
  
  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="#ffffff" font-size="20" font-weight="bold" font-family="sans-serif">Backpropagation: Flujo de Gradientes</text>
  
  <!-- Forward Pass Label -->
  <text x="450" y="70" text-anchor="middle" fill="#4FC3F7" font-size="14" font-weight="bold" font-family="sans-serif">→ Forward Pass (azul)</text>
  <text x="450" y="90" text-anchor="middle" fill="#FF5252" font-size="14" font-weight="bold" font-family="sans-serif">← Backward Pass (rojo)</text>
  
  <!-- Network Architecture -->
  <!-- Input Layer -->
  <g>
    <text x="100" y="130" text-anchor="middle" fill="#78909C" font-size="12" font-family="sans-serif">Input</text>
    <circle cx="100" cy="180" r="25" fill="#0288D1" stroke="#4FC3F7" stroke-width="2"/>
    <text x="100" y="185" text-anchor="middle" fill="white" font-size="14" font-family="sans-serif">x₁</text>
    <circle cx="100" cy="260" r="25" fill="#0288D1" stroke="#4FC3F7" stroke-width="2"/>
    <text x="100" y="265" text-anchor="middle" fill="white" font-size="14" font-family="sans-serif">x₂</text>
  </g>
  
  <!-- Hidden Layer -->
  <g>
    <text x="300" y="130" text-anchor="middle" fill="#78909C" font-size="12" font-family="sans-serif">Hidden</text>
    <circle cx="300" cy="160" r="25" fill="#7B1FA2" stroke="#CE93D8" stroke-width="2"/>
    <text x="300" y="165" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif">h₁</text>
    <circle cx="300" cy="220" r="25" fill="#7B1FA2" stroke="#CE93D8" stroke-width="2"/>
    <text x="300" y="225" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif">h₂</text>
    <circle cx="300" cy="280" r="25" fill="#7B1FA2" stroke="#CE93D8" stroke-width="2"/>
    <text x="300" y="285" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif">h₃</text>
  </g>
  
  <!-- Output Layer -->
  <g>
    <text x="500" y="130" text-anchor="middle" fill="#78909C" font-size="12" font-family="sans-serif">Output</text>
    <circle cx="500" cy="220" r="30" fill="#2E7D32" stroke="#4CAF50" stroke-width="2"/>
    <text x="500" y="225" text-anchor="middle" fill="white" font-size="14" font-family="sans-serif">ŷ</text>
  </g>
  
  <!-- Loss -->
  <g>
    <text x="650" y="175" text-anchor="middle" fill="#78909C" font-size="12" font-family="sans-serif">Loss</text>
    <rect x="600" y="190" width="100" height="60" rx="10" fill="#C62828" stroke="#FF5252" stroke-width="2"/>
    <text x="650" y="215" text-anchor="middle" fill="white" font-size="12" font-family="sans-serif">L(ŷ, y)</text>
    <text x="650" y="235" text-anchor="middle" fill="#FFCDD2" font-size="10" font-family="sans-serif">MSE/BCE</text>
  </g>
  
  <!-- Forward connections (blue) -->
  <g stroke="#4FC3F7" stroke-width="2" fill="none">
    <line x1="125" y1="180" x2="275" y2="160" marker-end="url(#arrow)"/>
    <line x1="125" y1="180" x2="275" y2="220" marker-end="url(#arrow)"/>
    <line x1="125" y1="180" x2="275" y2="280" marker-end="url(#arrow)"/>
    <line x1="125" y1="260" x2="275" y2="160" marker-end="url(#arrow)"/>
    <line x1="125" y1="260" x2="275" y2="220" marker-end="url(#arrow)"/>
    <line x1="125" y1="260" x2="275" y2="280" marker-end="url(#arrow)"/>
    
    <line x1="325" y1="160" x2="470" y2="210" marker-end="url(#arrow)"/>
    <line x1="325" y1="220" x2="470" y2="220" marker-end="url(#arrow)"/>
    <line x1="325" y1="280" x2="470" y2="230" marker-end="url(#arrow)"/>
    
    <line x1="530" y1="220" x2="598" y2="220" marker-end="url(#arrow)"/>
  </g>
  
  <!-- Weight labels -->
  <text x="180" y="155" fill="#4FC3F7" font-size="10" font-family="sans-serif">W¹</text>
  <text x="390" y="190" fill="#4FC3F7" font-size="10" font-family="sans-serif">W²</text>
  
  <!-- Backward connections (red) -->
  <g stroke="#FF5252" stroke-width="2" stroke-dasharray="5,3" fill="none">
    <line x1="598" y1="230" x2="535" y2="230" marker-end="url(#arrowRed)"/>
    
    <line x1="465" y1="210" x2="330" y2="165" marker-end="url(#arrowRed)"/>
    <line x1="465" y1="225" x2="330" y2="225" marker-end="url(#arrowRed)"/>
    <line x1="465" y1="235" x2="330" y2="285" marker-end="url(#arrowRed)"/>
  </g>
  
  <!-- Gradient formulas -->
  <rect x="720" y="120" width="160" height="200" rx="10" fill="#263238" stroke="#546E7A" stroke-width="1"/>
  <text x="800" y="145" text-anchor="middle" fill="#FF5252" font-size="12" font-weight="bold" font-family="sans-serif">Gradientes</text>
  
  <g font-size="10" font-family="monospace" fill="#FFCDD2">
    <text x="730" y="175">∂L/∂ŷ</text>
    <text x="730" y="200">∂L/∂W² = δ² · h</text>
    <text x="730" y="225">∂L/∂h = W²ᵀ · δ²</text>
    <text x="730" y="250">∂L/∂W¹ = δ¹ · x</text>
  </g>
  
  <text x="800" y="290" text-anchor="middle" fill="#78909C" font-size="9" font-family="sans-serif">δ = error local</text>
  
  <!-- Chain Rule Box -->
  <rect x="50" y="350" width="380" height="180" rx="10" fill="#1E3A5F" stroke="#2196F3" stroke-width="2"/>
  <text x="240" y="380" text-anchor="middle" fill="#4FC3F7" font-size="14" font-weight="bold" font-family="sans-serif">Regla de la Cadena</text>
  
  <g font-size="12" font-family="monospace">
    <text x="70" y="415" fill="#B0BEC5">Para W² (última capa):</text>
    <text x="80" y="440" fill="#81C784">∂L/∂W² = ∂L/∂ŷ · ∂ŷ/∂z² · ∂z²/∂W²</text>
    
    <text x="70" y="475" fill="#B0BEC5">Para W¹ (capa oculta):</text>
    <text x="80" y="500" fill="#81C784">∂L/∂W¹ = ∂L/∂h · ∂h/∂z¹ · ∂z¹/∂W¹</text>
  </g>
  
  <!-- Update Rule Box -->
  <rect x="470" y="350" width="380" height="180" rx="10" fill="#1E3A5F" stroke="#4CAF50" stroke-width="2"/>
  <text x="660" y="380" text-anchor="middle" fill="#4CAF50" font-size="14" font-weight="bold" font-family="sans-serif">Actualización de Pesos</text>
  
  <g font-size="14" font-family="monospace">
    <text x="490" y="420" fill="#FFB74D">W = W - η · ∂L/∂W</text>
    <text x="490" y="455" fill="#FFB74D">b = b - η · ∂L/∂b</text>
  </g>
  
  <g font-size="11" font-family="sans-serif">
    <text x="490" y="490" fill="#78909C">η = learning rate (0.01, 0.001, ...)</text>
    <text x="490" y="515" fill="#78909C">Dirección: opuesta al gradiente</text>
  </g>
  
  <!-- Bottom note -->
  <text x="450" y="545" text-anchor="middle" fill="#FFC107" font-size="11" font-family="sans-serif">⚡ Backprop calcula TODOS los gradientes en una sola pasada hacia atrás</text>
</svg>
