# Docker Compose para Stack ML Completo
#
# Servicios:
# - api: FastAPI ML API
# - prometheus: Recolección de métricas
# - grafana: Visualización de métricas
#
# Ejecutar: docker compose up --build

version: '3.8'

services:
  # ============================================
  # ML API
  # ============================================
  # TODO: Configurar servicio de API
  
  # api:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: ml-api-prod
  #   ports:
  #     - "8000:8000"
  #   env_file:
  #     - .env
  #   volumes:
  #     - ./ml_models:/app/ml_models:ro
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 3
  #     start_period: 10s
  #   restart: unless-stopped
  #   networks:
  #     - ml-network

  # ============================================
  # Prometheus
  # ============================================
  # TODO: Configurar Prometheus
  
  # prometheus:
  #   image: prom/prometheus:v2.47.0
  #   container_name: prometheus
  #   ports:
  #     - "9090:9090"
  #   volumes:
  #     - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro
  #     - prometheus-data:/prometheus
  #   command:
  #     - '--config.file=/etc/prometheus/prometheus.yml'
  #     - '--storage.tsdb.path=/prometheus'
  #     - '--web.enable-lifecycle'
  #   networks:
  #     - ml-network

  # ============================================
  # Grafana
  # ============================================
  # TODO: Configurar Grafana
  
  # grafana:
  #   image: grafana/grafana:10.1.0
  #   container_name: grafana
  #   ports:
  #     - "3000:3000"
  #   environment:
  #     - GF_SECURITY_ADMIN_USER=${GF_SECURITY_ADMIN_USER:-admin}
  #     - GF_SECURITY_ADMIN_PASSWORD=${GF_SECURITY_ADMIN_PASSWORD:-admin}
  #     - GF_USERS_ALLOW_SIGN_UP=false
  #   volumes:
  #     - ./monitoring/grafana/provisioning:/etc/grafana/provisioning:ro
  #     - grafana-data:/var/lib/grafana
  #   depends_on:
  #     - prometheus
  #   networks:
  #     - ml-network

# ============================================
# Volumes
# ============================================
# TODO: Definir volúmenes

# volumes:
#   prometheus-data:
#   grafana-data:

# ============================================
# Networks
# ============================================
# TODO: Definir red

# networks:
#   ml-network:
#     driver: bridge
